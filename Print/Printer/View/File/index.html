{//打印管理界面}
<extend name="Public/template/printerbase.html"/>
<block name='title'>{$title}</block>
<block name='header'>
<meta http-equiv="refresh" content="120">
<IF condition='$history'>
<include file="./Public/template/printernav.html" list="current_page_item"/>
<ELSE/>
<include file="./Public/template/printernav.html" manage="current_page_item"/>
</IF>
</block>
<block name='content'>
<div class="title" >
    <h2>{$title}</h2>
</div>
<div class="container">
    <table class=" table table-responsive">
        <thead>
            <tr>
                <th>待打印文件</th>
                <th>上传者</th>
                <th>上传时间</th>
                <th>文件打印状态</th>
                <if condition="$history">
                <else />
                <th>操作</th>>
                </if>
            </tr>
        </thead>
        <tbody>
            <volist name="data" id="vo">
            <tr>
                <td><a target='_blank' href="__UPLOAD__/{$vo.url}">{$vo.name}</a></td>
                <td>{$vo.use_name}[{$vo.student_number}]</td>
                <td>{$vo.time}</td>
                <td id="{$vo.id}_status" data='{$vo.status}'>
                    <switch name="vo['status']">
                    <case value="1">尚未下载</case>
                    <case value="2">已下载</case>
                    <case value="3">正在打印</case>
                    <case value="4">已打印待付款</case>
                    <case value="5">已付款</case>
                    <default />未知状态
                    </switch>
                </td>
                <if condition="$history">
                <else />
                <td>
                    <button type="button" id="{$vo.id}_button" fid='{$vo.id}' class="set btn btn-success">
                    <switch name="vo['status']">
                    <case value="1">通知已打印</case>
                    <case value="2">通知已打印</case>
                    <case value="3">通知已打印</case>
                    <case value="4">确认已付款</case>
                    <default />不可操作
                    </switch>
                    </button>
                </td>
                </if>
            </tr>
            </volist>
        </tbody>
    </table>
</div>
</block>
<block name='end'>
<script>
        $(".set").on('click',function(){
            var URL = "/Printer/File/set";
            var btn=$(this);
            var fid=btn.attr('fid');
            var status=$('#'+fid+'_status');
            var sid=status.attr('data');
            var set_s=0;
            if(sid<=3&&sid>=1){
                set_s=4;
            }else if(sid==4){
                set_s=5;
            }
            $.post(URL,{
                fid:fid,
                status:set_s
            },function(data){
                if(data.status){
                    status.attr('data',set_s);
                    status.html('已打印');
                    if(set_s==4){
                        btn.html('确认已付款').removeClass("btn btn-primary").addClass("btn btn-warning");
                    }else{
                        btn.parent().parent().hide(2000);
                    }
                }
            });
        });
</script>
</block>